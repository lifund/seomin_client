<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서민피자 관리자</title>
    <!-- stylesheet_placeholder -->

</head>
<body>

    <main>

        <button id="logout_button">로그아웃</button>
        <iframe hidden width="0" height="0" name="dummyframe" id="dummyframe"></iframe>

        <!------------------ 가맹 문의 ------------------>
        <section>
            <h2>가맹 문의</h2>
            <div class="category_button">
                <button id="franchise_inquiry_submitted_button" class="button_active">접수</button>
                <button id="franchise_inquiry_resolved_button" class="button_inactive">완료</button>
            </div>
            <div id="franchise_inquiry_submitted_container" class="card_container m__franchise_inquiry_submitted"></div>
            <div id="franchise_inquiry_resolved_container" class="card_container m__franchise_inquiry_resolved" hidden></div>
        </section>

        <script>
            function request_post(url="", data={}, successCallback=function(){}, errorCallback=function(){}){
                var xhr = new XMLHttpRequest();
                xhr.open("POST", url);
                xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
                xhr.onload = function () {
                    if(this.responseText === 'success'){
                        successCallback();
                    }else{
                        errorCallback();
                    }
                };
                xhr.send(JSON.stringify(data));
            }
            


            document.getElementById('franchise_inquiry_submitted_button').addEventListener('click',function(ev){
                document.getElementById('franchise_inquiry_submitted_container').removeAttribute('hidden');
                document.getElementById('franchise_inquiry_submitted_button').classList.remove('button_inactive');
                document.getElementById('franchise_inquiry_submitted_button').classList.add('button_active');
                document.getElementById('franchise_inquiry_resolved_container').setAttribute('hidden','');
                document.getElementById('franchise_inquiry_resolved_button').classList.add('button_inactive');
                document.getElementById('franchise_inquiry_resolved_button').classList.remove('button_active');
            });
            document.getElementById('franchise_inquiry_resolved_button').addEventListener('click',function(ev){
                document.getElementById('franchise_inquiry_resolved_container').removeAttribute('hidden');
                document.getElementById('franchise_inquiry_resolved_button').classList.remove('button_inactive');
                document.getElementById('franchise_inquiry_resolved_button').classList.add('button_active');
                document.getElementById('franchise_inquiry_submitted_container').setAttribute('hidden','');
                document.getElementById('franchise_inquiry_submitted_button').classList.add('button_inactive');
                document.getElementById('franchise_inquiry_submitted_button').classList.remove('button_active');
            });

            var franchise_inquiry_changeStatus = document.getElementsByClassName('franchise_inquiry_changeStatus');
            for (let i = 0; i < franchise_inquiry_changeStatus.length; i++) {
                var element = franchise_inquiry_changeStatus[i];
                element.addEventListener('click',function(ev){
                    var real = document.getElementById(ev.currentTarget.id+'_el');
                    if (ev.currentTarget.innerText == '완료 상태로 변경'){
                        request_post(
                            '/admin/franchiseInquiry/statusUpdate',
                            {
                                "collection":"franchise_inquiry",
                                "id":ev.currentTarget.id,
                                "document": { $set: { "status" : "완료" } }
                            },
                            function(){
                                window.location = '/admin';
                            }
                        );

                    }
                    if (ev.currentTarget.innerText == '접수 상태로 되돌리기'){
                        request_post(
                            '/admin/franchiseInquiry/statusUpdate',
                            {
                                "collection":"franchise_inquiry",
                                "id":ev.currentTarget.id,
                                "document": { $set: { "status" : "접수" } }
                            },
                            function(){
                                window.location = '/admin';
                            }
                        );
                        
                    }
                });
            };
            
        </script>

        <!------------------ 고객 문의 ------------------>
        <section>
            <h2>고객의 소리</h2>
            <div class="category_button">
                <button id="shop_inquiry_submitted_button" class="button_active">접수</button>
                <button id="shop_inquiry_resolved_button" class="button_inactive">완료</button>
            </div>
            <div id="shop_inquiry_submitted_container" class="card_container m__shop_inquiry_submitted"></div>
            <div id="shop_inquiry_resolved_container" class="card_container m__shop_inquiry_resolved" hidden></div>
        </section>

        <script>
            document.getElementById('shop_inquiry_submitted_button').addEventListener('click',function(ev){
                document.getElementById('shop_inquiry_submitted_container').removeAttribute('hidden');
                document.getElementById('shop_inquiry_submitted_button').classList.remove('button_inactive');
                document.getElementById('shop_inquiry_submitted_button').classList.add('button_active');
                document.getElementById('shop_inquiry_resolved_container').setAttribute('hidden','');
                document.getElementById('shop_inquiry_resolved_button').classList.add('button_inactive');
                document.getElementById('shop_inquiry_resolved_button').classList.remove('button_active');
            });
            document.getElementById('shop_inquiry_resolved_button').addEventListener('click',function(ev){
                document.getElementById('shop_inquiry_resolved_container').removeAttribute('hidden');
                document.getElementById('shop_inquiry_resolved_button').classList.remove('button_inactive');
                document.getElementById('shop_inquiry_resolved_button').classList.add('button_active');
                document.getElementById('shop_inquiry_submitted_container').setAttribute('hidden','');
                document.getElementById('shop_inquiry_submitted_button').classList.add('button_inactive');
                document.getElementById('shop_inquiry_submitted_button').classList.remove('button_active');
            });


            var shop_inquiry_changeStatus = document.getElementsByClassName('shop_inquiry_changeStatus');
            for (let i = 0; i < shop_inquiry_changeStatus.length; i++) {
                var element = shop_inquiry_changeStatus[i];
                element.addEventListener('click',function(ev){
                    var real = document.getElementById(ev.currentTarget.id+'_el');
                    if (ev.currentTarget.innerText == '완료 상태로 변경'){
                        request_post(
                            '/admin/shopInquiry/statusUpdate',
                            {
                                "collection":"shop_inquiry",
                                "id":ev.currentTarget.id,
                                "document": { $set: { "status" : "완료" } }
                            },
                            function(){
                                window.location = '/admin';
                            }
                        );
                    }
                    if (ev.currentTarget.innerText == '접수 상태로 되돌리기'){
                        request_post(
                            '/admin/shopInquiry/statusUpdate',
                            {
                                "collection":"shop_inquiry",
                                "id":ev.currentTarget.id,
                                "document": { $set: { "status" : "접수" } }
                            },
                            function(){
                                window.location = '/admin';
                            }
                        );
                        
                    }
                });
            };
        </script>

        <!--

        <section>
            <h2>가맹점 데이터</h2>
            <button>가맹점 추가하기</button>
            
            <div class="card_container m__shop_list"></div>
        </section>
        

        <section>
            <h2>메뉴 데이터</h2>
            <button>메뉴 추가하기</button>

            <div class="card_container m__menu_list"></div>

        </section>

     
        -->


        
        <!------------------------------------------------------------------------------------>
        <!--------------------------------------- 팝업 ---------------------------------------->
        <!------------------------------------------------------------------------------------>

        <!--------------------------------------- 주소검색 ---------------------------------------->

        <div id="addressSearch" class="popup" hidden>
            <a id="removeMenuPopup_address"><!-- menu_fold --><svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 36L36 20" stroke="black" stroke-width="2" stroke-linecap="round"/><path d="M20 20L36 36" stroke="black" stroke-width="2" stroke-linecap="round"/></svg></a>
            <h2>주소 검색하기</h2>
            <input type="text" name="addressQuery" id="addressQuery" placeholder="주소 입력">
            <input type="submit" value="검색">
            <table id="addressList">
                <tr>
                    <th>지번주소</th>
                    <th>도로명주소</th>
                    <th>시/도</th>
                    <th>군/구</th>
                </tr>
            </table>
        </div>
        <script>
            var shop_address_searchButton = document.getElementsByClassName('shop_address_searchButton');
            for (let i = 0; i < shop_address_searchButton.length; i++) {
                shop_address_searchButton[i].addEventListener('click',function(ev){
                    document.getElementById('addressSearch').removeAttribute('hidden');
                });
            }
            document.getElementById('removeMenuPopup_address').addEventListener('click',function(ev){
                document.getElementById('addressSearch').setAttribute('hidden','');
            });
        </script>


    </main>




    <!--------------------------------------------------------------------------------------------->
    <!------------------------------------------ SCRIPT ------------------------------------------->
    <!--------------------------------------------------------------------------------------------->
    <script>

        function parseCookie(cookieString){
            var cookieArray = cookieString.split(';');
            var cookieObject = {};
            for (let i = 0; i < cookieArray.length; i++) {
                cookieObject[cookieArray[i].split('=')[0]] = cookieArray[i].split('=')[1];
            } 
            return cookieObject;
        }
        var cookie = parseCookie(document.cookie);


        function logout(){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/admin/logout");
            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            var submitForm = {
                'sessionKey': cookie['sessionKey']
            };
            xhr.send(JSON.stringify(submitForm));
        }

        document.getElementById('logout_button').addEventListener('click',function(ev){
            logout();
            window.location = '/admin';
        });



    </script>
</body>
</html>